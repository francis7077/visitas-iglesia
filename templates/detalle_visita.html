{% extends "base.html" %}
{% block contenido %}

<h2 class="titulo-principal">üìñ Seguimiento: <span style="color:#4a6cf7;">{{ persona.nombre }}</span></h2>

<div style="display: flex; gap: 15px; margin-bottom: 20px;">
    <div class="tarjeta-perfil" style="flex: 1; text-align: center; background: #f8fafc; margin:0;">
        <div style="font-size: 0.75em; color: #64748b; text-transform: uppercase; font-weight:700;">Total Contactos</div>
        <div style="font-size: 1.8em; font-weight: 800; color: #1e40af;">{{ total_visitas }}</div>
    </div>
    <div class="tarjeta-perfil" style="flex: 1; text-align: center; background: #f8fafc; margin:0;">
        <div style="font-size: 0.75em; color: #64748b; text-transform: uppercase; font-weight:700;">√öltima Visita</div>
        <div style="font-size: 1.1em; font-weight: 800; padding-top: 5px; color: #334155;">
            {{ ultima_visita.fecha_visita | formato_fecha if ultima_visita else 'Ninguna' }}
        </div>
    </div>
</div>

<div class="tarjeta-perfil">
    <div style="display:flex; justify-content:space-between; align-items:center; border-bottom: 2px solid #f1f5f9; padding-bottom: 12px; margin-bottom: 15px;">
        <h3 style="margin:0; font-size: 1.1em;">Historial Cronol√≥gico</h3>
        <span class="badge ok">{{ visitas|length }} registros</span>
    </div>

    {% if visitas %}
        <div class="tabla-contenedor" style="border-radius: 12px; border: 1px solid #e2e8f0;">
            <table>
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Ministerio / Visitante</th>
                        <th>Observaciones</th>
                        <th style="text-align:center">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for v in visitas %}
                    <tr {% if loop.first %} style="background: #f0f7ff; border-left: 4px solid #3b82f6;" {% endif %}>
                        <td style="white-space: nowrap;">
                            <strong>{{ v.fecha_visita | formato_fecha }}</strong>
                        </td>
                        <td>
                            <span style="color: #1e40af; font-weight: 600; font-size: 0.9em;">{{ v.visitado_por }}</span>
                        </td>
                        <td>
                            <p style="color: #475569; font-size: 0.9em; margin:0; line-height:1.4;">{{ v.nota or "Sin observaciones." }}</p>
                        </td>
                        <td style="text-align:center">
                            <div style="display: flex; justify-content: center; gap: 15px; font-size: 1.2em;">
                                <a href="{{ url_for('editar_visita', id=v.id) }}" title="Editar" style="text-decoration:none;">‚úèÔ∏è</a>
                                <a href="{{ url_for('eliminar_visita', id=v.id) }}" title="Eliminar" 
                                   onclick="return confirm('¬øEliminar este registro permanentemente?')" 
                                   style="text-decoration:none;">üóëÔ∏è</a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div style="text-align: center; padding: 40px 20px; background: #fef2f2; border: 2px dashed #fecaca; border-radius: 16px;">
            <div style="font-size: 3em; margin-bottom: 10px;">üïäÔ∏è</div>
            <strong style="color: #991b1b; display:block;">Sin historial de seguimiento todav√≠a.</strong>
            <p style="color: #b91c1c; font-size: 0.9em;">Es una gran oportunidad para realizar la primera visita.</p>
        </div>
    {% endif %}
</div>

<div class="tarjeta-perfil" style="border-top: 6px solid #10b981; background: #ffffff;">
    <h3 style="color: #065f46; display: flex; align-items: center; gap: 10px; margin-top:0;">
        <span>‚ú®</span> Registrar Nueva Actividad
    </h3>

    <form method="post" style="margin-top: 20px;">
        <div class="perfil-grid"> <div>
                <label>Visitado por:</label>
                <select name="visitado_por" required>
                    <option value="" disabled selected>Seleccione Ministerio</option>
                    <option>Sociedad de J√≥venes</option>
                    <option>Sociedad de Damas</option>
                    <option>Sociedad de Caballeros</option>
                    <option>Directiva Local</option>
                    <option>Familia Pastoral</option>
                    <option>Visita Mixta</option>
                </select>
            </div>
            <div>
                <label>Fecha de la visita:</label>
                <input type="date" name="fecha_visita" required value="{{ ahora.strftime('%Y-%m-%d') }}">
            </div>
        </div>

        <div style="margin-top: 15px;">
            <label>Nota / Observaci√≥n Pastoral:</label>
            <textarea name="nota" rows="4" placeholder="Detalle aqu√≠ lo conversado o peticiones de oraci√≥n..." style="width: 100%; border-radius: 12px; padding: 12px; border: 1px solid #cbd5e1;"></textarea>
        </div>

        <button type="submit" style="margin-top: 20px; width: 100%; background: #10b981; padding: 14px; font-size: 16px;">
            üíæ Guardar Seguimiento
        </button>
    </form>
</div>

<div style="text-align:center; margin: 40px 0;">
    <a href="{{ url_for('visitas') }}" style="color: #64748b; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 5px;">
        ‚¨ÖÔ∏è Volver al Listado General
    </a>
</div>

{% endblock %}